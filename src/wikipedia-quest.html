<link rel="import" href="node_modules/@polymer/polymer/polymer.html" />
<link rel="import" href="video-player.html" />
<link rel="import" href="total-time.html" />

<dom-module id="wikipedia-quest">
	<template>
		<style>
			#title{
				/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#666666+0,343434+100 */
				background: #666666; /* Old browsers */
				background: -moz-linear-gradient(top,  #666666 0%, #343434 100%); /* FF3.6-15 */
				background: -webkit-linear-gradient(top,  #666666 0%,#343434 100%); /* Chrome10-25,Safari5.1-6 */
				background: linear-gradient(to bottom,  #666666 0%,#343434 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
				filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#666666', endColorstr='#343434',GradientType=0 ); /* IE6-9 */
			}
			#title h1{
				text-align: center;
				padding-top: .67em;
				padding-bottom: .67em;
				margin: 0;
				color:#F1f1d4;
			}
			#navBar{
				text-align:center;
				background-color: #333;
			}
			ul.topnav {
				list-style-type: none;
				margin: 0;
				padding: 0;
				overflow: hidden;
				display: block;
				max-width:960px;
				width: 100%;
				
				margin: auto;
			}
			
			ul.topnav li {
				float:left;
				width:320px;
			}
			ul.topnav li a {
				display: inline-block;
				box-sizing: border-box;
				color: #F1f1d4;
				text-decoration: none;
				transition: 0.3s;
				font-size: 17px;
				width: 100%;
				padding-top: 16px;
				padding-bottom: 16px;
				border-style: solid;
				border-color: gray;
				border-top-style: none;
				border-bottom-style: none;
				border-width: 1px;
			}
			
			@media(max-width:959px){
				ul.topnav li{
					width: 33.3333%;
				}
			
			}

			ul.topnav li a:hover {
				background-color: #111;
			}
			
			#mainContent{
				max-width: 960px;
				margin: auto;
			}
			
			div.explore div{
				box-sizing: border-box;
				float: left;
				padding: 5px;
				overflow:hidden;
			}
			
			div.wrapper{
				background-color: #333;
				box-sizing: border-box;
				float: left;
				padding: 5px;
				overflow:hidden;
				width:100%;
			}
			div.content{
				box-sizing: border-box;
				float: left;
				padding: 5px;
				background-color:#F1f1d4;
				overflow:hidden;
				width: 100%;
			}
			div.halfSize{
				width:50%;
			}
			div.halfSize div{
				min-height:300px;
			}
			h2{
				text-align:center;
			}
			div.menu div button{
				display:block;
				margin:auto;
			}
			p.questText{
				text-align: center;
				font-size:24pt;
			}
			.pageImage{
				max-width: 200px;
				margin:auto;
				display: block;
			}
			#newGameButton {
				margin-top:100px;
			}
			#overviewWrapper {
				width: 75%;
				min-height:500px;
			}
			#overviewContent{
				min-height:490px;
			}
			#linksWrapper{
				width: 25%;
				min-height:500px;
			}
			#linksContent{
				min-height:490px;
			}
			#exploreWrapper{
				width: 75%;
				min-height: 150px;
			}
			#exploreContent{
				min-height: 150px;
			}
			#exploreLink{
				display: block;
				text-align: center;
				padding-top: 15px;
				padding-bottom: 15px;
				margin-top: 45px;
				
				width: 200px;
				margin-left: auto;
				margin-right: auto;
				background-color: white;
				border-style: solid;
				border-radius: 20px;
				
				text-decoration: None;
				color: black;
				
				background: #caeefa;

				transition: 0.3s;
				
			}
			#exploreLink:hover{
				background: #93e0fa;
			}
			#searchWrapper{
				width: 25%;
				min-height: 150px;
			}
			#searchContent{
				min-height:150px;
			}
			#searchButton{
				box-sizing: border-box;
				width: 20%;
				min-width:17px;
			}
			#searchText{
				width: 75%;
				box-sizing: border-box;
			}
		</style>
		
  <header>
	<div id="title">
	<h1>Wikipedia Quest</h1>
	
	</div>

	<div id="navBar">
		<ul class="topnav">
			<li><a href="/menu">Main Menu</a></li>
			<li><a href="/explore">Explore</a></li>
			<li><a href="/questLog">Quest Log</a></li>
		</ul>
	</div>
	</header>
	
	<div id="webComponentBody">
	
		<div id="mainContent">
		
			<template is="dom-if" if="[[main_menu_view_]]">
				<div class="menu" hidden=[[!display_]]>
					<div class="wrapper">
						<div id="menuInstructions" class="content">
							
							<h2>Welcome to Wikipedia Quest!</h2>
							<p>
							A wondrous adventure awaits you in the land of Wikipedia. 
							Traverse from one article to the next along paths 
							both familiar and obscure. A number of links will be presented
							to you at each new step in your journey, but searching for a more direct
							path is the only reliable way to finish your quest.<br><br>
							Will you complete your quest and be forever remembered as a hero?<br>
							Will you wander aimlessly, learning one factoid after another?<br><br>
							Either way, remember that the journey matters far more than the destination!
							</p>
						</div>
					</div>
					
					<div class="wrapper halfSize">
						<div id="loadGameDiv" class="content">
						<h2>Load Game</h2>
						<p><strong>Current Page:</strong> [[saved_current_wiki_page]]</p>
						<p><strong>Destination:</strong> [[saved_destination]]</p>
						<p><strong>Number of pages visited:</strong> [[saved_num_pages_visited]]</p>
						<p><strong>Total time elapsed:</strong> [[saved_additional_time]]</p>
						<button id="loadButton">Load Game</button>
						</div>
					</div>
						
					<div class="wrapper halfSize">
						<div id="NewGameDiv" class="content">
						<h2>New Game</h2>
						<button id="newGameButton">Start New Game</button>
						</div>
					</div>
					
					<div class="wrapper">
						<div class="content">
							<h2>Save Game</h2>
							<p>
							<strong>WARNING:</strong>
							This will overwrite any old save data, so
							don't do this if you still want to load the current
							saved game.
							</p>
							<button id="saveButton">Save Game</button>
						</div>
					</div>
				</div>
			</template>
			
			<template is="dom-if" if="[[explore_view_]]">
				<div class="explore" hidden=[[!display_]]>
			
					<div id="overviewWrapper" class="wrapper">
						<div id="overviewContent" class="content">
							<h2>[[current_wiki_page]]</h2>
							<p id="page_summary">[[page_summary]]</p>
							<img class="pageImage" src="[[page_image_url]]"/>
						</div>
					</div>

					<div id="linksWrapper" class="wrapper">
						<div id="linksContent" class="content">
							<p>Obvious paths lead to...</p>
							<ul>
								<li><a href="/explore/Kevin%20Bacon">Bacon (Kevin)</a></li>
								<li><a href="/explore/Lorem%20Ipsum%201">Lorem Ipsum 1</a></li>
								<li><a href="/explore/Lorem%20Ipsum%202">Lorem Ipsum 2</a></li>
								<li><a href="/explore/Lorem%20Ipsum%203">Lorem Ipsum 3</a></li>
								<li><a href="/explore/Lorem%20Ipsum%204">Lorem Ipsum 4</a></li>
							</ul>
						</div>
					</div>

					<div id="exploreWrapper" class="wrapper">
						<div id="exploreContent" class="content">
							<a id="exploreLink" href="http://en.wikipedia.org/wiki/[[current_wiki_page]]" target="_blank">
							Explore Further!</a>
						</div>
					</div>

					<div id="searchWrapper" class="wrapper">
						<div id="searchContent" class="content">
							<p>Type in the name of an article that <strong>[[current_wiki_page]]</strong>
							links to and discover a different path.</p>
							<input id="searchText" type="text"></input>
							<button id="searchButton">Go!</button>
						</div>
					</div>
			
				</div>
			</template>
			
			<template is="dom-if" if="[[questView_]]">
				<div class="quest" hidden=[[!display_]]>
					<div class="wrapper">
						<div class="content">
							<h2>Quest Log</h2>
						</div>
					</div>
					<div class="wrapper halfSize">
						<div class="content">
							<h2>Origin</h2>
							<p class="questText">[[origin]]</p>
							<img class="pageImage" src="[[origin_img]]"/>
						</div>
					</div>
					<div class="wrapper halfSize">
						<div class="content">
							<h2>Destination</h2>
							<p class="questText">[[destination]]</p>
							<img class="pageImage" src="[[destination_img]]"/>
						</div>
					</div>
					<div class="wrapper">
						<div class="content">
							<h2>Number of Pages Visited</h2>
							<p class="questText">[[num_pages_visited]]</p>
						</div>
					</div>
					<div class="wrapper">
						<div class="content">
							<h2>Total Time Elapsed</h2>
							<total-time start_time="[[main_start_time]]" loaded_time="[[loaded_total_time]]" ></total-time>
						</div>
					</div>
					<div class="wrapper">
						<div class="content">
							<h2>Questing Music</h2>
							<video-player 
							video_playlist='["https://www.youtube.com/embed/WgXqGBcGdX8",
										  "https://www.youtube.com/embed/zlkIUmn5USg",
										  "https://www.youtube.com/embed/x-NBfQOAdRI",
										  "https://www.youtube.com/embed/bl9dP0CJfbQ",
							              "https://www.youtube.com/embed/vdNpaJwLiZA",
										  "https://www.youtube.com/embed/WFkGjEut9U4"]'>
							</video-player>
						</div>
					</div>
				</div>
		</template>
		
		</div>
	
	</div>
   
  </template>
  <script>
    // element registration
    Polymer({
      is: "wikipedia-quest",

      
		properties: {
		
			current_wiki_page: {
				type: String,
				value: ""
			},
			origin:{
				type: String,
				value: "???"
			},
			origin_img:{
				type: String,
				value: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Made20bacon.png/320px-Made20bacon.png"
			},
			destination: {
				type: String,
				value: "???"
			},
			destination_img:{
				type: String,
				value: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Made20bacon.png/320px-Made20bacon.png"
			},
			num_pages_visited: {
				type: Number,
				value: 1
			},
			
			
			main_start_time: {
				type: Number,
				value: function(){return Math.floor(Date.now() / 1000);}
			},
			loaded_total_time: {
				type: Number,
				value: 0
			},
			
			
			
			saved_current_wiki_page: {
				type: String,
				value: "???"
			},
			saved_origin: {
				type: String,
				value: "???"
			},
			saved_destination: {
				type: String,
				value: "???"
			},
			saved_num_pages_visited:{
				type: Number,
				value: 0
			},
			saved_additional_time:{
				type: Number,
				value: 0
			},
			
			
			page_summary: {
				type: String,
				value: ""
			},
			page_image_url: {
				type: String,
				value: ""
			},
			
			
			wiki_page_changed:{
				type: Boolean,
				value: false
			},
			origin_changed:{
				type: Boolean,
				value: false
			},
			destination_changed:{
				type: Boolean,
				value: false
			},


			error_msg: {
				type: String,
				value: "An error occurred."
			},
			player_initialized_: {
				type: Boolean,
				value: false
			},
			loading_: {
				type: Boolean,
				value: true
			},
			error_: {
				type: Boolean,
				value: false
			},
			display_: {
				type: Boolean,
				value: false
			},
			main_menu_view_:{
				type: Boolean,
				value: true
			},
			explore_view_: {
				type: Boolean,
				value: false
			},
    },

    attached: function () {
      this.welcomeUser_();
    },
	  
	welcomeUser_: function(){
		this.loading_ = true;
		this.display_ = false;
		this.main_menu_view_ = true;
		this.explore_view_ = false;
		this.questView_ = false;
		
		//Check if the browser has save data stored in it.
		//If so, set the proper values, which are used by menu's html.
		
		//If not, set any necessary values, which are also used by menu's html.
		
		this.current_wiki_page = "Bacon";
		
		this.loading_ = false;
		this.display_ = true;
	},
	  
	beginNewGame_: function(){
		//Do all of the javascript-side setup for a new game:
		// Select two random pages
		// Make sure that all of the proper variables are initialized to zero.
		loadQuestView_();
	},

	loadQuestView_: function(){
		this.display_ = false;
		this.main_menu_view_ = false;
		this.explore_view_ = false;
		this.questView_ = true;

		this.display_ = true;
	},
	
	
	// loadMainMenu_()
	//
	// Responsible for:
	//	Changing boolean values to display the menu view. - COMPLETE
	
	loadMainMenu_: function(){
		this.display_ = false;
		this.main_menu_view_ = true;
		this.explore_view_ = false;
		this.questView_ = false;
			
		this.display_ = true;
	},

	attributeChanged: function (name, type) {
		if (/^current_wiki_page$/i.test(name)) {
			this.loadWikiPage_();
		}
	},
  
	loadWikiPage_: function () {
		this.loading_ = true;
		this.display_ = false;
		this.error_ = false;
		this.main_menu_view_ = false;
		this.explore_view_ = true;
		this.questView_ = false;
	
		this.page_summary = 	"Bacon is a meat product prepared from a pig and usually cured. " +
							"It is first cured using large quantities of salt, either in a " +
							"brine or in a dry packing; the result is fresh bacon (also known " +
							"as green bacon). Fresh bacon may then be further dried for weeks " +
							"or months in cold air, or it may be boiled or smoked. Fresh and " +
							"dried bacon is typically cooked before eating, often by frying. " +
							"Boiled bacon is ready to eat, as is some smoked bacon, but may be " +
							"cooked further before eating.";
							
		this.page_image_url = "https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Made20bacon.png/320px-Made20bacon.png"
	
		//Make a call to the mediaWiki API here.
		/*
		 {}.bind(this))
				.catch((function (err) {
			if(err.message === "server500Error"){
			this.error_msg = "A server error occurred. Sorry!";
			this.error_ = true;
		}
		if(err.message === "server404Error"){
			this.error_msg = "We have no data for that date.";
			this.error_ = true;
		}
					if(err.message === "invalidDate"){
			this.error_msg = "The submitted date was invalid.";
			this.error_ = true;
		}
		this.loading_ = false;
		this.display_ = false;
		
				}).bind(this));
		*/
	
		this.loading_ = false;
		this.display_ = true;
	},
	  
	removeAllLinks: function() {
	//Same idea, but remove links instead.
	/*var Ul = this.$.listOfEvents;

	while(Ul.firstChild != null){
		Ul.firstChild.remove();
	}*/
	},

	insertAllEvents: function() {
	//Add links with the wiki names
	//The links will go to the page routing, though.

	/*
	var Ul = this.$.listOfEvents;

	if(this.eventList){
		for( var i = 0; i < this.eventList.length ; i++){

		  
		  var newListElement = document.createElement("li");
		  var newParagraph = document.createElement("p"); 
		  var newLink = document.createElement("a");
		  
		  newParagraph.innerHTML = this.formattotal-time(this.eventList[i]);
		  newLink.href = this.getMoreInfoLink(this.eventList[i].link);
		  newLink.innerHTML = this.eventList[i].title.$t;
		  
		  newParagraph.appendChild(newLink);
		  newListElement.appendChild(newParagraph);
		  
		  
		  Ul.appendChild(newListElement);
		}
	}
	else{
		throw new Error("invalidDate");
	}
	*/

	},
	getMoreInfoLink: function (links) {
	//Can use the same idea to generate the hrefs for the wiki links.

	/*if (!links || links.length < 1) {
	  return '#';
	}

	for (var i = 0; i < links.length; i++) {
	  if (links[i].rel === 'alternate' && links[i].type === 'text/html') {
		return links[i].href;
	  }
	}

	return '#'; */
	}
	});
  </script>
</dom-module>